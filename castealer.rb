#!/usr/bin/env ruby

require 'openssl'

key = OpenSSL::PKey::RSA.new(2048)
ca_cert = OpenSSL::X509::Certificate.new(File.read("ca.pem"))
############# You Forgot the exploit#################
a = File.open("root"".key", "w")
a.syswrite("#{cert.public_key}")
a.syswrite("#{key.to_pem}")
spoof = OpenSSL::PKey::RSA.new File.read 'root.key'
printf "Verifying Keys Work: "
puts "before we sign the cert: #{ca_cert.verify(key)}"
ca_cert.sign(spoof, OpenSSL::Digest::SHA1.new)
puts "after we sign the cert: #{ca_cert.verify(key)}"
